<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Basic metadata -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- HTMX library: enables dynamic server interactions without full page reloads -->
    <script src="https://unpkg.com/htmx.org@2.0.4"
        integrity="sha384-HGfztofotfshcF7+8n44JQL2oJmowVChPTg48S+jvZoztPfvwD79OC/LTtG6dMp+"
        crossorigin="anonymous">
    </script>

    <title>User Search</title>

    <!-- Bootstrap CSS for styling and layout -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
        crossorigin="anonymous">

    <!-- Link to custom CSS -->
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="container search-container">
        <h1>üîç Search Users</h1>

        <!-- Main search card -->
        <div class="search-card">
            <div class="search-wrapper">
                <!-- Search icon for visual cue -->
                <span class="search-icon">üîç</span>

                <!-- Search input -->
                <input 
                    type="text" 
                    class="form-control" 
                    id="search-input"
                    name="search" 
                    placeholder="Search by name or email..."
                    
                    
                    hx-post="/search"            
                    hx-trigger="input changed delay:500ms, search"  
                    hx-target="#search-results"                     
                    hx-indicator=".loading-spinner"                 
                    autocomplete="off">

                <!-- Clear button (appears when user types) -->
                <button class="clear-btn" id="clear-btn" onclick="clearSearch()">‚úï</button>

                <!-- Spinner that appears when search request is pending -->
                <div class="loading-spinner spinner-border spinner-border-sm text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
            </div>

            <!-- Area for displaying result summary (e.g., ‚Äú5 results found for ...‚Äù) -->
            <div id="result-info-container"></div>

            <!-- Search results table -->
            <div class="table-container">
                <table class="table">
                    <thead>
                        <tr>
                            <th scope="col">Name</th>
                            <th scope="col">Email</th>
                            <th scope="col">Username</th>
                        </tr>
                    </thead>
                    <tbody id="search-results">
                        <!-- Default placeholder shown before any search -->
                        <tr>
                            <td colspan="3" class="no-results">
                                <div class="no-results-icon">üë•</div>
                                <h5>Start typing to search users</h5>
                                <p class="mb-0">Search by name or email address</p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS bundle (for responsive and interactive components) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
    
    <!-- Inline JavaScript for front-end behavior -->
    <script>
        const searchInput = document.getElementById('search-input');
        const clearBtn = document.getElementById('clear-btn');

        // ‚úÖ Show or hide the clear (‚úï) button depending on input state
        searchInput.addEventListener('input', function() {
            if (this.value.length > 0) {
                clearBtn.classList.add('visible');
            } else {
                clearBtn.classList.remove('visible');
            }
        });

        // ‚úÖ Clears the search box and restores the initial table message
        function clearSearch() {
            searchInput.value = '';
            clearBtn.classList.remove('visible');
            document.getElementById('search-results').innerHTML = `
                <tr>
                    <td colspan="3" class="no-results">
                        <div class="no-results-icon">üë•</div>
                        <h5>Start typing to search users</h5>
                        <p class="mb-0">Search by name or email address</p>
                    </td>
                </tr>
            `;
            document.getElementById('result-info-container').innerHTML = '';
            searchInput.focus();
        }

        // ‚úÖ Updates result info after HTMX replaces the #search-results section
        document.body.addEventListener('htmx:afterSwap', function(event) {
            // Only trigger this logic when search results table is updated
            if (event.detail.target.id === 'search-results') {
                const rows = document.querySelectorAll('#search-results tr');
                const count = rows.length;
                const searchTerm = searchInput.value;
                
                // If valid search and results exist
                if (searchTerm && count > 0 && !rows[0].querySelector('.no-results')) {
                    document.getElementById('result-info-container').innerHTML = `
                        <div class="result-info">
                            <span class="result-count">
                                ${count} ${count === 1 ? 'result' : 'results'} found
                            </span>
                            <span class="badge bg-primary">
                                Searching for: "${searchTerm}"
                            </span>
                        </div>
                    `;
                } else {
                    // Clear info if no valid results
                    document.getElementById('result-info-container').innerHTML = '';
                }
            }
        });
    </script>
</body>

</html>
